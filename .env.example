# Database
DATABASE_URL=postgresql://username:password@host:port/database

# ============================================
# S3 Storage Configuration
# ============================================

# S3 bucket for configs and cache (required for S3 mode)
S3_BUCKET=docpythia-storage
S3_REGION=us-east-1

# S3 credentials (optional - uses default credential chain if not set)
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# Custom S3 endpoint for S3-compatible services (MinIO, etc.)
# S3_ENDPOINT=https://minio.example.com

# Storage mode: 's3' or 'local' (default: local)
CONFIG_SOURCE=local
CACHE_STORAGE=local

# S3 prefixes (optional)
# CONFIG_S3_PREFIX=configs/
# CACHE_S3_PREFIX=cache/

# Admin Authentication
# Admin passwords are configured per-instance in config/{instance}/instance.json
# Set to 'true' to disable admin authentication (DEVELOPMENT ONLY!)
DISABLE_ADMIN_AUTH=false

# Scheduler Configuration
SCHEDULER_ENABLED=false
CRON_SCHEDULE=0 2 * * *
SCRAPE_LIMIT=100
ANALYSIS_LIMIT=50

# ============================================
# Zulip Stream Adapter Configuration
# ============================================

# Instance-specific Zulip bot credentials (recommended for multi-tenant)
# Pattern: {INSTANCE_UPPERCASE}_ZULIP_BOT_EMAIL and {INSTANCE_UPPERCASE}_ZULIP_API_KEY
# Example:
#   PROJECTA_ZULIP_BOT_EMAIL=projecta-bot@zulipchat.com
#   PROJECTA_ZULIP_API_KEY=abc123xyz456def789ghi
#   PROJECTB_ZULIP_BOT_EMAIL=projectb-bot@zulipchat.com
#   PROJECTB_ZULIP_API_KEY=xyz789def456abc123ghi
#
# If instance-specific credentials not found, falls back to generic credentials:
ZULIP_BOT_EMAIL=your-bot@zulipchat.com
ZULIP_API_KEY=your_zulip_api_key_here

# Generic Zulip site (can be overridden per-instance in config)
ZULIP_SITE=https://yourorg.zulipchat.com

# Polling Configuration
ZULIP_POLLING_INTERVAL=30000  # 30 seconds
ZULIP_BATCH_SIZE=100          # Messages per fetch

# Bot Behavior
ZULIP_IGNORE_OLD_MESSAGES=true  # Ignore messages before bot initialization

# Legacy compatibility (deprecated - use stream configs instead)
ZULIP_CHANNEL=community-support

# Google AI API (for analysis)
GOOGLE_AI_API_KEY=your_google_ai_api_key
GEMINI_API_KEY=your_gemini_api_key
GEMINI_EMBED_MODEL=gemini-embedding-001

# OpenAI API (if used)
OPENAI_API_KEY=your_openai_api_key

# Application
NODE_ENV=production
PORT=8080

# Widget Configuration
WIDGET_DOMAIN=http://localhost:3762
WIDGET_TITLE=                           # Default: "{PROJECT_NAME} Assistant"
WIDGET_WELCOME_MESSAGE=                 # Default: "Hello! I'm your {PROJECT_NAME} documentation assistant..."
WIDGET_PLACEHOLDER=                     # Default: "Ask me anything about {PROJECT_NAME}..."
WIDGET_NAMESPACE=DocPythiaWidget           # JavaScript namespace for the widget
WIDGET_SUGGESTED_QUESTIONS=             # Pipe-separated: "Question 1|Question 2|Question 3"

# RAG Configuration
# NOTE: DOCS_GIT_URL and DOCS_GIT_BRANCH are configured in config/instance.json
# You can override them here if needed, but the config file is the primary source
# DOCS_GIT_URL=https://github.com/your-org/your-docs
# DOCS_GIT_BRANCH=main
# DOCS_CACHE_DIR=/var/cache/your-project-docs
RAG_ENABLED=true
RAG_TOP_K=3
RAG_MAX_TOKENS=3500

# Git Authentication (optional, for private repos)
GIT_USERNAME=
GIT_TOKEN=

# ============================================
# Multi-Stream Scanner Configuration (Phase 1)
# Batch Processing Architecture (2025-10-31)
# ============================================

# Project Context (used in LLM prompts)
# NOTE: PROJECT_NAME and PROJECT_DESCRIPTION are configured in config/instance.json
# You can override them here if needed, but the config file is the primary source
# PROJECT_NAME=YourProject
# PROJECT_DESCRIPTION="AI-powered documentation management system for Your Protocol"
DOC_PURPOSE="Technical documentation for developers and DevOps engineers"
TARGET_AUDIENCE="Developers, DevOps engineers, validators, and infrastructure operators"
STYLE_GUIDE="Clear, concise, technical writing with practical examples"

# LLM Model Configuration (3 models: classification, proposal, consolidation)
LLM_CLASSIFICATION_MODEL=gemini-2.5-flash
LLM_PROPOSAL_MODEL=gemini-2.5-flash
LLM_CONSOLIDATION_MODEL=gemini-2.5-flash

# Batch Processing Configuration
BATCH_WINDOW_HOURS=24           # Process messages in 24-hour batches
CONTEXT_WINDOW_HOURS=24         # Include 24 hours of previous context
MAX_BATCH_SIZE=500              # Maximum messages per batch
MIN_CONFIDENCE=0.7              # Minimum confidence for proposals

# Stream Manager
STREAM_MANAGER_ENABLED=true
STREAM_ERROR_RETRY_ATTEMPTS=3
STREAM_ERROR_RETRY_DELAY=60000
MAX_CONCURRENT_STREAMS=3

# Admin Approval
# All proposals require manual admin approval (no auto-approval)

# ============================================
# Telegram Bot Configuration (Multi-Instance)
# ============================================

# Instance-specific Telegram bot tokens (recommended for multi-tenant)
# Pattern: {INSTANCE_UPPERCASE}_TELEGRAM_BOT_TOKEN
# Example:
#   PROJECTA_TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
#   PROJECTB_TELEGRAM_BOT_TOKEN=789012:XYZ-ABC5678mnOpq-rst89V4w2u567fg33
#
# If instance-specific token not found, falls back to generic token:
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# Bot Operation Mode: 'polling' for development, 'webhook' for production
TELEGRAM_BOT_MODE=polling

# Webhook Configuration (only needed if mode=webhook)
# TELEGRAM_WEBHOOK_URL=https://your-domain.com
# TELEGRAM_WEBHOOK_PATH=/telegram-webhook

# Polling Configuration
TELEGRAM_POLLING_INTERVAL=3000

# Chat Whitelist (comma-separated chat IDs, leave empty to allow all)
# Get chat IDs by sending a message then checking: curl https://api.telegram.org/bot<TOKEN>/getUpdates
# Example: TELEGRAM_ALLOWED_CHATS=-1001234567890,-1009876543210
# TELEGRAM_ALLOWED_CHATS=

# Bot Behavior
TELEGRAM_IGNORE_OLD_MESSAGES=false    # Ignore messages sent before bot started
TELEGRAM_PROCESS_COMMANDS=true       # Enable bot commands (/start, /status)
TELEGRAM_SAVE_RAW_UPDATES=true       # Save full Telegram update JSON in database

# ============================================
# PR Generation Configuration (Phase 2)
# Automated Pull Request Generation (2025-11-06)
# ============================================

# GitHub API Configuration
GITHUB_TOKEN=your_github_personal_access_token_here

# Default PR Configuration
# The repository where PRs will be created (requires write access)
DEFAULT_TARGET_REPO=username/repo-name
DEFAULT_BASE_BRANCH=main

# Legacy: Source repo is no longer needed (kept for backwards compatibility)
# PRs are created within the same repository from a branch to the base branch
DEFAULT_SOURCE_REPO=username/repo-name

# PR Generation Settings
PR_WORK_DIR=/tmp/pr-workspaces
PR_AUTO_CLEANUP=true